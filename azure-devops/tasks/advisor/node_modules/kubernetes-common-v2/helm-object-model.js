"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tl = require("azure-pipelines-task-lib/task");
class Helm {
    constructor(kubectlPath, namespace) {
        this.helmPath = kubectlPath;
        if (!!namespace) {
            this.namespace = namespace;
        }
        else {
            this.namespace = "default";
        }
    }
    template(releaseName, chartPath, overrideFiles, overrideValues) {
        var command = tl.tool(this.helmPath);
        command.arg("template");
        command.arg(chartPath);
        if (releaseName) {
            command.arg(["--name", releaseName]);
        }
        command.arg(["--namespace", this.namespace]);
        if (overrideFiles.length > 0) {
            overrideFiles.forEach(file => {
                command.arg(["-f", file]);
            });
        }
        command.arg(this._buildSetArguments(overrideValues));
        return command.execSync();
    }
    _buildSetArguments(overrideValues) {
        var newArgs = [];
        overrideValues.forEach(overrideValue => {
            newArgs.push("--set");
            newArgs.push(`${overrideValue.name}=${overrideValue.value}`);
        });
        return newArgs;
    }
}
exports.Helm = Helm;
